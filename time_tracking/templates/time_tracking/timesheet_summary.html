{% extends "base.html" %}
{% load static %}
{% block title %}Timesheet Summary{% endblock %}

{% block page_header %}
<div class="page-header">
  <div>
    <h1 class="page-title">Timesheet Summary</h1>
    <p class="page-subtitle">{{ week_start }} – {{ week_end }}{% if target_user != user %} for {{ target_user.get_full_name|default:target_user.username }}{% endif %}</p>
  </div>
  <div class="page-header-actions">
    <a href="?week_start={{ prev_week|date:'Y-m-d' }}{% if is_manager and target_user %}&user={{ target_user.pk }}{% endif %}" class="btn btn-secondary">← Prev week</a>
    <a href="?week_start={{ next_week|date:'Y-m-d' }}{% if is_manager and target_user %}&user={{ target_user.pk }}{% endif %}" class="btn btn-secondary">Next week →</a>
    <a href="{% url 'time_entry_export_csv' %}?from={{ week_start }}&to={{ week_end }}{% if is_manager and target_user %}&user={{ target_user.pk }}{% endif %}" class="btn-csv-export">
      <span class="btn-csv-circle" aria-hidden="true">&#8595;</span>
      <span class="btn-csv-title">Export CSV</span>
    </a>
    <a href="{% url 'time_entry_list' %}?week_start={{ week_start|date:'Y-m-d' }}" class="btn btn-secondary">Log time</a>
  </div>
</div>
{% endblock %}

{% block content %}
{% if is_manager and users %}
<form method="get" style="margin-bottom: 1rem;">
  <label>User: <select name="user" class="form-control" style="width: auto;" onchange="this.form.submit()">
    <option value="">—</option>
    {% for u in users %}<option value="{{ u.pk }}" {% if target_user == u %}selected{% endif %}>{{ u.get_full_name|default:u.username }}</option>{% endfor %}
  </select></label>
  <input type="hidden" name="week_start" value="{{ week_start|date:'Y-m-d' }}">
</form>
{% endif %}

<div class="card">
  <table class="data-table">
    <thead>
      <tr>
        <th>PROJECT</th>
        <th>TASK TYPE</th>
        <th>HOURS</th>
      </tr>
    </thead>
    <tbody>
      {% for row in summary %}
      <tr>
        <td>{{ row.project.project_number }} – {{ row.project.name }}</td>
        <td>{{ row.task_type }}</td>
        <td>{{ row.hours|floatformat:1 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <p style="margin-top: 0.75rem;"><strong>Total: {{ total_hours|floatformat:1 }} hrs</strong></p>
</div>
{% if not summary %}
<p style="color: var(--text-muted);">No time entries for this week.</p>
{% endif %}
{% endblock %}
